package com.smhrd.controller;

import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.smhrd.model.MemberDAO;
import com.smhrd.model.MemberVO;


@WebServlet("/updateController")
public class updateController extends HttpServlet {
	private static final long serialVersionUID = 1L;

	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		 HttpSession session = request.getSession();
	        String userId = (String) session.getAttribute("userId");

	        if (userId == null) {
	            response.sendRedirect("login.jsp");  // 로그인되지 않은 사용자라면 로그인 페이지로 리디렉션
	            return;
	        }

	        // 폼에서 전달된 값 가져오기
	        String updatePw = request.getParameter("update_pw");
	        String updateTel = request.getParameter("update_tel");
	        String updateAddress = request.getParameter("update_Address");


	        MemberVO member = new MemberVO();
	        member.setId(userId); 
	        member.setPw(updatePw);
	        member.setTel(updateTel);
	        member.setAddress(updateAddress);

	        MemberDAO dao = new MemberDAO();
	        int result = dao.updateMember(member);  
	        
	        if (result > 0) {
	            session.setAttribute("userId", userId);  
	            response.sendRedirect("main.jsp");  
	        } else {
	            
	        	 req.setAttribute("result_F", "수정 실패");
	        	        
	        	        String path="update.jsp";
	        	        RequestDispatcher rd=req.getRequestDispatcher(path);
	        	        rd.forward(req, resp);
	            
	        }

	}

}
